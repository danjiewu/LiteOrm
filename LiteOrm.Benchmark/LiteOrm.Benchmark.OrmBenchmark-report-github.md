# LiteOrm 性能基准测试报告

## 测试环境

### 硬件环境

| 项目 | 配置 |
| :--- | :--- |
| 操作系统 | Windows 11 (10.0.22631.6199/23H2/2023Update/SunValley3) |
| CPU | 13th Gen Intel Core i5-13400F 2.50GHz |
| CPU 核心数 | 1 CPU, 16 logical and 10 physical cores |
| 内存 | 32G |

### 软件环境

| 项目 | 版本 |
| :--- | :--- |
| .NET SDK | 10.0.103 |
| .NET Runtime | .NET 10.0.3 (10.0.3, 10.0.326.7603), X64 RyuJIT x86-64-v3 |
| BenchmarkDotNet | 0.15.8 |
| 数据库 | MySQL (通过 MySqlConnector 连接) |

### 测试框架版本

| 框架 | 版本 |
| :--- | :--- |
| **LiteOrm** | 8.0.7 |
| **FreeSql** | 3.2.833 (FreeSql.Provider.MySqlConnector) |
| **SqlSugar** | 5.1.4.211 (SqlSugarCore) |
| **Dapper** | 2.1.35 |
| **EF Core** | 9.0.0 (Pomelo.EntityFrameworkCore.MySql) |

### 测试配置

| 参数 | 值 |
| :--- | :--- |
| Job | MediumRun |
| IterationCount | 15 |
| LaunchCount | 2 |
| WarmupCount | 10 |

---

## 性能对比汇总

### 一、插入性能 (Insert Async)

| 框架 | Batch=100 | Batch=1000 | Batch=5000 |
| :--- | ---: | ---: | ---: |
| **LiteOrm** | **3,743.9 μs** | **10,711.9 μs** | **40,268.4 μs** |
| FreeSql | 4,358.7 μs | 17,707.5 μs | 72,488.8 μs |
| SqlSugar | 4,126.6 μs | 15,775.0 μs | 76,643.9 μs |
| Dapper | 13,236.3 μs | 120,213.5 μs | 690,745.5 μs |
| EF Core | 21,973.8 μs | 169,846.8 μs | 824,700.5 μs |

### 二、更新性能 (Update Async)

| 框架 | Batch=100 | Batch=1000 | Batch=5000 |
| :--- | ---: | ---: | ---: |
| **LiteOrm** | **4,684.3 μs** | **16,472.2 μs** | **68,069.3 μs** |
| FreeSql | 4,859.8 μs | 30,842.5 μs | 133,942.8 μs |
| SqlSugar | 5,377.7 μs | 35,522.5 μs | 194,130.4 μs |
| Dapper | 16,492.4 μs | 132,356.8 μs | 659,912.8 μs |
| EF Core | 21,571.2 μs | 149,932.5 μs | 749,069.8 μs |

### 三、Upsert 性能 (Insert or Update Async)

| 框架 | Batch=100 | Batch=1000 | Batch=5000 |
| :--- | ---: | ---: | ---: |
| LiteOrm | 5,535.7 μs | 16,733.4 μs | 60,711.4 μs |
| **FreeSql** | **4,843.1 μs** | **14,769.0 μs** | **58,183.2 μs** |
| SqlSugar | 9,355.1 μs | 66,357.1 μs | 885,872.8 μs |
| Dapper | 18,593.3 μs | 136,051.1 μs | 677,140.4 μs |
| EF Core | 22,967.5 μs | 157,037.7 μs | 794,845.9 μs |

### 四、关联查询性能 (Join Query Async)

| 框架 | Batch=100 | Batch=1000 | Batch=5000 |
| :--- | ---: | ---: | ---: |
| LiteOrm | 974.9 μs | **6,061.1 μs** | **39,060.2 μs** |
| FreeSql | 942.3 μs | 6,520.9 μs | 41,220.4 μs |
| SqlSugar | 1,664.3 μs | 12,304.3 μs | 63,744.0 μs |
| **Dapper** | **893.4 μs** | 6,556.1 μs | 39,942.4 μs |
| EF Core | 6,680.8 μs | 12,422.7 μs | 49,403.4 μs |

---

## 最优性能汇总

### 按数据规模汇总最优框架

| 测试项目 | 100 条 | 1000 条 | 5000 条 |
| :--- | :--- | :--- | :--- |
| **Insert** | **LiteOrm** (3,743.9 μs) | **LiteOrm** (10,711.9 μs) | **LiteOrm** (40,268.4 μs) |
| **Update** | **LiteOrm** (4,684.3 μs) | **LiteOrm** (16,472.2 μs) | **LiteOrm** (68,069.3 μs) |
| **Upsert** | **FreeSql** (4,843.1 μs) | **FreeSql** (14,769.0 μs) | **FreeSql** (58,183.2 μs) |
| **JoinQuery** | **Dapper** (893.4 μs) | **LiteOrm** (6,061.1 μs) | **LiteOrm** (39,060.2 μs) |

### 按内存分配汇总最优框架

| 测试项目 | 100 条 | 1000 条 | 5000 条 |
| :--- | :--- | :--- | :--- |
| **Insert** | **LiteOrm** (295.97 KB) | **LiteOrm** (870.27 KB) | **LiteOrm** (4,082.59 KB) |
| **Update** | **LiteOrm** (353.82 KB) | **LiteOrm** (1,514.47 KB) | **LiteOrm** (7,498.47 KB) |
| **Upsert** | **FreeSql** (264.88 KB) | **LiteOrm** (2,138.49 KB) | **LiteOrm** (8,034.00 KB) |
| **JoinQuery** | **LiteOrm** (90.19 KB) | **LiteOrm** (628.98 KB) | **LiteOrm** (3,073.58 KB) |

---

## 结论

LiteOrm 在以下场景表现优异：

1. **插入性能 (Insert)**：在所有数据规模下均表现最优，100/1000/5000 条数据测试均为最快
2. **更新性能 (Update)**：在所有数据规模下均表现最优
3. **内存占用**：在所有测试项目中均表现最优，内存分配远低于其他框架
4. **关联查询 (Join)**：在 1000 和 5000 条数据规模下表现最优，100 条时略逊于 Dapper

---

## 附录：原始测试结果

```
BenchmarkDotNet v0.15.8, Windows 11 (10.0.22631.6199/23H2/2023Update/SunValley3)
13th Gen Intel Core i5-13400F 2.50GHz, 1 CPU, 16 logical and 10 physical cores
.NET SDK 10.0.103
  [Host]    : .NET 10.0.3 (10.0.3, 10.0.326.7603), X64 RyuJIT x86-64-v3
  MediumRun : .NET 10.0.3 (10.0.3, 10.0.326.7603), X64 RyuJIT x86-64-v3

Job=MediumRun  IterationCount=15  LaunchCount=2
WarmupCount=10

```
| Method                        | Batch | Mean         | Error        | StdDev       | Gen0       | Gen1      | Gen2     | Allocated    |
|------------------------------ |----------- |-------------:|-------------:|-------------:|-----------:|----------:|---------:|-------------:|
| **EFCore_Insert_Async**           | **100**        |  **21,973.8 μs** |    **324.55 μs** |    **485.77 μs** |   **187.5000** |   **62.5000** |        **-** |   **1965.32 KB** |
| SqlSugar_Insert_Async         | 100        |   4,126.6 μs |    134.87 μs |    197.69 μs |    39.0625 |    7.8125 |        - |    476.13 KB |
| LiteOrm_Insert_Async          | 100        |   3,743.9 μs |    125.45 μs |    175.87 μs |    23.4375 |         - |        - |    295.97 KB |
| Dapper_Insert_Async           | 100        |  13,236.3 μs |    296.72 μs |    444.12 μs |    15.6250 |         - |        - |    254.58 KB |
| FreeSql_Insert_Async          | 100        |   4,358.7 μs |    124.89 μs |    186.93 μs |    39.0625 |    7.8125 |        - |    460.62 KB |
| EFCore_Update_Async           | 100        |  21,571.2 μs |    327.09 μs |    479.44 μs |   156.2500 |   31.2500 |        - |    1692.9 KB |
| SqlSugar_Update_Async         | 100        |   5,377.7 μs |    150.90 μs |    225.86 μs |    78.1250 |   23.4375 |        - |    800.73 KB |
| LiteOrm_Update_Async          | 100        |   4,684.3 μs |    126.65 μs |    189.57 μs |    31.2500 |    7.8125 |        - |    353.82 KB |
| Dapper_Update_Async           | 100        |  16,492.4 μs |    793.28 μs |  1,162.78 μs |    31.2500 |         - |        - |    320.98 KB |
| FreeSql_Update_Async          | 100        |   4,859.8 μs |    168.36 μs |    246.77 μs |    62.5000 |   15.6250 |        - |    692.96 KB |
| EFCore_Upsert_Async   | 100        |  22,967.5 μs |    415.57 μs |    609.14 μs |   156.2500 |   31.2500 |        - |   1656.64 KB |
| SqlSugar_Upsert_Async | 100        |   9,355.1 μs |    234.01 μs |    328.05 μs |   140.6250 |   46.8750 |        - |   1458.24 KB |
| LiteOrm_Upsert_Async  | 100        |   5,535.7 μs |    295.06 μs |    432.49 μs |    39.0625 |    7.8125 |        - |    460.94 KB |
| Dapper_Upsert_Async   | 100        |  18,593.3 μs |    490.56 μs |    734.24 μs |          - |         - |        - |     291.8 KB |
| FreeSql_Upsert_Async  | 100        |   4,843.1 μs |    170.49 μs |    255.18 μs |    23.4375 |         - |        - |    264.88 KB |
| EFCore_JoinQuery_Async        | 100        |   6,680.8 μs |    114.50 μs |    160.51 μs |    31.2500 |         - |        - |    385.12 KB |
| SqlSugar_JoinQuery_Async      | 100        |   1,664.3 μs |     15.91 μs |     22.82 μs |    93.7500 |    7.8125 |        - |    995.55 KB |
| LiteOrm_JoinQuery_Async       | 100        |     974.9 μs |     18.56 μs |     27.79 μs |     7.8125 |    1.9531 |        - |     90.19 KB |
| Dapper_JoinQuery_Async        | 100        |     893.4 μs |     26.72 μs |     39.99 μs |     3.9063 |         - |        - |     50.45 KB |
| FreeSql_JoinQuery_Async       | 100        |     942.3 μs |     12.24 μs |     18.31 μs |     9.7656 |    1.9531 |        - |    112.84 KB |
| **EFCore_Insert_Async**           | **1000**       | **169,846.8 μs** |  **4,691.58 μs** |  **6,876.86 μs** |  **1666.6667** |  **666.6667** |        **-** |  **18118.07 KB** |
| SqlSugar_Insert_Async         | 1000       |  15,775.0 μs |    320.45 μs |    479.63 μs |   437.5000 |  281.2500 |  31.2500 |   4571.36 KB |
| LiteOrm_Insert_Async          | 1000       |  10,711.9 μs |    312.16 μs |    467.23 μs |    78.1250 |   15.6250 |        - |    870.27 KB |
| Dapper_Insert_Async           | 1000       | 120,213.5 μs |  6,285.42 μs |  9,014.36 μs |          - |         - |        - |   2476.22 KB |
| FreeSql_Insert_Async          | 1000       |  17,707.5 μs |    722.09 μs |  1,058.42 μs |   437.5000 |  187.5000 |        - |   4629.99 KB |
| EFCore_Update_Async           | 1000       | 149,932.5 μs |  4,545.40 μs |  6,803.34 μs |  1333.3333 |  666.6667 |        - |  15149.28 KB |
| SqlSugar_Update_Async         | 1000       |  35,522.5 μs |   957.07 μs |  1,432.50 μs |   714.2857 |  500.0000 |        - |   7677.75 KB |
| LiteOrm_Update_Async          | 1000       |  16,472.2 μs |   346.77 μs |   486.13 μs |   125.0000 |   31.2500 |        - |   1514.47 KB |
| Dapper_Update_Async           | 1000       | 132,356.8 μs |  3,281.43 μs |  4,600.11 μs |          - |         - |        - |   3094.99 KB |
| FreeSql_Update_Async          | 1000       |  30,842.5 μs |  1,262.79 μs |  1,890.08 μs |   718.7500 |  468.7500 | 125.0000 |   6877.24 KB |
| EFCore_Upsert_Async   | 1000       | 157,037.7 μs |  4,096.07 μs |  5,742.12 μs |  1333.3333 |  666.6667 |        - |  14803.48 KB |
| SqlSugar_Upsert_Async | 1000       |  66,357.1 μs |  1,837.08 μs |  2,514.61 μs |  3400.0000 | 1000.0000 |        - |  35952.45 KB |
| LiteOrm_Upsert_Async  | 1000       |  16,733.4 μs |  1,367.82 μs |  2,004.94 μs |   187.5000 |   93.7500 |        - |   2138.49 KB |
| Dapper_Upsert_Async   | 1000       | 136,051.1 μs |  2,830.66 μs |  4,059.65 μs |          - |         - |        - |   2798.43 KB |
| FreeSql_Upsert_Async  | 1000       |  14,769.0 μs |    257.24 μs |    368.92 μs |   218.7500 |   78.1250 |        - |   2239.19 KB |
| EFCore_JoinQuery_Async        | 1000       |  12,422.7 μs |   164.27 μs |   230.28 μs |   187.5000 |   62.5000 |        - |   2198.79 KB |
| SqlSugar_JoinQuery_Async      | 1000       |  12,304.3 μs |   240.52 μs |   359.99 μs |   890.6250 |  250.0000 |        - |   9226.19 KB |
| LiteOrm_JoinQuery_Async       | 1000       |   6,061.1 μs |   111.92 μs |   167.51 μs |    54.6875 |   15.6250 |        - |    628.98 KB |
| Dapper_JoinQuery_Async        | 1000       |   6,556.1 μs |   287.60 μs |   430.46 μs |    39.0625 |    7.8125 |        - |    415.97 KB |
| FreeSql_JoinQuery_Async       | 1000       |   6,520.9 μs |   203.90 μs |   292.43 μs |    78.1250 |   31.2500 |        - |    854.07 KB |
| **EFCore_Insert_Async**           | **5000**       | **824,700.5 μs** | **16,886.50 μs** | **23,114.43 μs** |  **7000.0000** | **2000.0000** |        **-** |  **80230.09 KB** |
| SqlSugar_Insert_Async         | 5000       |  76,643.9 μs |  1,493.31 μs |  2,093.41 μs |  2400.0000 |  1200.0000 |  400.0000 |  23196.37 KB |
| LiteOrm_Insert_Async          | 5000       |  40,268.4 μs |  1,198.77 μs |  1,794.26 μs |   363.6364 |  181.8182 |        - |   4082.59 KB |
| Dapper_Insert_Async           | 5000       | 690,745.5 μs | 46,735.79 μs | 69,951.93 μs |  1000.0000 |         - |        - |  12349.48 KB |
| FreeSql_Insert_Async          | 5000       |  72,488.8 μs |  1,051.53 μs |  1,573.87 μs |  2142.8571 | 1285.7143 |        - |  23333.54 KB |
| EFCore_Update_Async           | 5000       | 749,069.8 μs | 16,928.29 μs | 25,337.47 μs |  7000.0000 |  2000.0000 |        - |  73697.34 KB |
| SqlSugar_Update_Async         | 5000       | 194,130.4 μs |  5,663.61 μs |  8,301.64 μs |  3666.6667 | 1666.6667 |  333.3333 |  38811.48 KB |
| LiteOrm_Update_Async          | 5000       |  68,069.3 μs |  1,871.27 μs |  2,800.83 μs |   666.6667 |  333.3333 |        - |   7498.47 KB |
| Dapper_Update_Async           | 5000       | 659,912.8 μs | 14,083.83 μs | 20,198.61 μs |  1000.0000 |         - |        - |  15477.98 KB |
| FreeSql_Update_Async          | 5000       | 133,942.8 μs |  2,867.33 μs |  4,291.69 μs |  3000.0000 |  666.6667 |        - |  34449.51 KB |
| EFCore_Upsert_Async   | 5000       | 794,845.9 μs | 11,707.66 μs | 17,160.94 μs |  6000.0000 |  2000.0000 |        - |  63887.09 KB |
| SqlSugar_Upsert_Async | 5000       | 885,872.8 μs | 19,128.67 μs | 28,630.89 μs | 82000.0000 |  2000.0000 |        - | 844275.98 KB |
| LiteOrm_Upsert_Async  | 5000       |  60,711.4 μs |  1,926.23 μs |  2,823.44 μs |   666.6667 |  500.0000 |        - |      8034 KB |
| Dapper_Upsert_Async   | 5000       | 677,140.4 μs | 12,561.83 μs | 18,412.97 μs |  1000.0000 |         - |        - |  13986.66 KB |
| FreeSql_Upsert_Async  | 5000       |  58,183.2 μs |  1,422.38 μs |  2,084.90 μs |   833.3333 |  666.6667 |        - |  11086.02 KB |
| EFCore_JoinQuery_Async        | 5000       |  49,403.4 μs |  2,204.14 μs |  3,299.05 μs |  1111.1111 |  666.6667 |  222.2222 |  10415.47 KB |
| SqlSugar_JoinQuery_Async      | 5000       |  63,744.0 μs |  2,050.14 μs |  3,068.55 μs |  4333.3333 |  666.6667 |        - |  45871.71 KB |
| LiteOrm_JoinQuery_Async       | 5000       |  39,060.2 μs |  2,868.84 μs |  4,205.11 μs |   300.0000 |  100.0000 |        - |   3073.58 KB |
| Dapper_JoinQuery_Async        | 5000       |  39,942.4 μs |  2,546.86 μs |  3,812.03 μs |   200.0000 |  100.0000 |        - |    2090.4 KB |
| FreeSql_JoinQuery_Async       | 5000       |  41,220.4 μs |  2,150.32 μs |  3,151.92 μs |   400.0000 |  200.0000 |        - |   4198.77 KB |
```
